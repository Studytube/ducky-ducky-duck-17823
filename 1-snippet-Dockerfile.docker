FROM ruby:3.2

WORKDIR /app

COPY . /app

COPY .ssh/id_rsa /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa

RUN apt-get update && apt-get install -y nodejs build-essential && rm -rf /var/lib/apt/lists/*

RUN gem install bundler -v 2.6.3 && bundle install

ENV RAILS_ENV=production
ENV SECRET_KEY_BASE=abc123def456ghi789jkl012mno345pqr678stu901vwx234yz

RUN chmod -R 777 /app

EXPOSE 22 3000

CMD ["bundle", "exec", "rails", "server", "-b", "0.0.0.0", "-p", "3000"]
